<!DOCTYPE html>
<html>
<head>
    <style>
   .brd {
    border: 100px;
    /* background: #fc3; */
    padding: 10px;
    margin-right: 90px;
    margin-top: 30px;
    text-align:right;
   }
   </style>
</head>

  <body>

    <div class="brd">
      {% if request.user.is_authenticated  %}
      <a href = "{% url 'logout-user' %}">Logout</a>
      {% endif %}
    </div>

    <div style="text-align:center">
      <h2>The chat has started.</h2>
      <h2>{{request.user}}</h2>
    </div>
    <br>

    <center>
    <div
      class="chat__item__container"
      id="id_chat_item_container"
      style="font-size: 20px"
    >
      <br />
      <input type="text" id="id_message_send_input" />
      <button type="submit" id="id_message_send_button">Send Message</button>
      <br />
      <br />
    </div>
    </center>

    <script>
      // create WebSocket object
      const chatSocket = new WebSocket("ws://" + window.location.host + "/");
      chatSocket.onopen = function (e) {
        console.log("The connection was setup successfully !");
      };

      // if the socket will close
      chatSocket.onclose = function (e) {
        console.log("Chat socket closed unexpectedly!");
      };

      // focus on the id_message_send_input
      document.querySelector("#id_message_send_input").focus();

      // sent a message from id_message_send_input when the Enter was clicked
      document.querySelector("#id_message_send_input").onkeyup = function (e) {
        if (e.keyCode == 13) {
          document.querySelector("#id_message_send_button").click();
        }
      };

      // sent a message from id_message_send_input when the id_message_send_button was clicked
      document.querySelector("#id_message_send_button").onclick = function (e) {
        var messageInput = document.querySelector("#id_message_send_input").value;
        chatSocket.send(JSON.stringify({ message: messageInput, username: "{{request.user.username}}"}));
      };

      // If a message arrives
      chatSocket.onmessage = function (e) {
        const data = JSON.parse(e.data);
        var div = document.createElement("div");
        div.innerHTML = data.username + ": " + data.message;
        document.querySelector("#id_message_send_input").value = "";
        document.querySelector("#id_chat_item_container").appendChild(div);
      };

    </script>
  </body>
</html>